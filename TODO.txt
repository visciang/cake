TODO

- semplificare?
    @import --output --as=app_ta components/app_ta app
    FROM app_ta:${CAKE_PIPELINE_UUID}

  usando --build-context:
    docker buildx build --builder dake --file Containerfile.1 --build-context test=docker-image://target:test .


- run against a private buildkit instance (implies the use of an external registry)
- include / import cycles
- matrix
- local task
- Cakefile FROM DOCKERFILE
- dot
? private targets (.target)



NOTE:

  BUILDKIT_VERSION=v0.12.3
  BUILDKIT_BUILDER_NAME=cake

  DOCKER_REGISTRY_VERSION=2.8.3
  DOCKER_REGISTRY_HOST=localhost:7000

  docker run --rm -d -p 7000:7000 --name registry registry:${DOCKER_REGISTRY_VERSION}

  docker buildx create --name=${BUILDKIT_BUILDER_NAME} --driver=docker-container --driver-opt=image=moby/buildkit:${BUILDKIT_VERSION},network=host

  docker buildx inspect --builder ${BUILDKIT_BUILDER_NAME}

  docker buildx build --builder=${BUILDKIT_BUILDER_NAME} -f Dockerfile \
          --push \
          -t ${DOCKER_REGISTRY_HOST}/my-alpine:latest \
          --cache-from=type=registry,ref=${DOCKER_REGISTRY_HOST}/my-alpine \
          --cache-to=type=registry,ref=${DOCKER_REGISTRY_HOST}/my-alpine:cache,mode=max \
          .
